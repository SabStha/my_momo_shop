# Lighthouse Optimization Guide - AmaKo Momo

## 📊 **Current Lighthouse Scores (Aug 31, 2025)**

| Metric | Current | Target | Gap | Priority |
|--------|---------|--------|-----|----------|
| **Performance** | 71 | ≥80 | +9 | 🔴 High |
| **Accessibility** | 67 | ≥90 | +23 | 🔴 High |
| **Best Practices** | 96 | ≥95 | ✅ | ✅ Achieved |
| **SEO** | 100 | ≥90 | ✅ | ✅ Achieved |

## 🎯 **Performance Optimizations (71 → 80)**

### **1. Enable Text Compression** ⭐⭐⭐
**Savings:** 457 KiB
**Status:** 🔴 Not Implemented

**Solution:**
```bash
# Install compression plugin
npm install vite-plugin-compression --save-dev
```

**Update vite.config.js:**
```javascript
import compression from 'vite-plugin-compression';

// Add to plugins array:
compression({ algorithm: 'brotliCompress' }),
compression({ algorithm: 'gzip' }),
```

### **2. Properly Size Images** ⭐⭐⭐
**Savings:** 2,799 KiB
**Status:** 🔴 Critical

**Solution:**
```bash
# Install sharp for image optimization
npm install sharp --save-dev

# Run image optimization
node scripts/optimize-images.mjs
```

**Update Blade templates:**
```blade
<x-optimized-image 
    src="/storage/products/foods/classic-pork-momos.jpg"
    alt="Classic Pork Momos"
    width="400"
    height="300"
    class="rounded-lg"
/>
```

### **3. Serve Images in Next-Gen Formats** ⭐⭐⭐
**Savings:** 1,158 KiB
**Status:** 🔴 Critical

**Solution:**
- WebP and AVIF formats will be generated by the image optimization script
- Use `<x-optimized-image>` component which includes `<picture>` with format fallbacks

### **4. Reduce Unused CSS** ⭐⭐
**Savings:** 117 KiB
**Status:** 🟡 Medium

**Solution:**
```bash
# Install PurgeCSS
npm install @fullhuman/postcss-purgecss --save-dev
```

**Update postcss.config.js:**
```javascript
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
    ...(process.env.NODE_ENV === 'production' ? { cssnano: {} } : {}),
    ...(process.env.NODE_ENV === 'production' ? {
      '@fullhuman/postcss-purgecss': {
        content: [
          './resources/**/*.blade.php',
          './resources/**/*.js',
          './resources/**/*.vue',
        ],
        defaultExtractor: content => content.match(/[\w-/:]+(?<!:)/g) || [],
      },
    } : {}),
  },
}
```

### **5. Reduce Unused JavaScript** ⭐⭐
**Savings:** 91 KiB
**Status:** 🟡 Medium

**Solution:**
- Code splitting is already implemented
- Review and remove unused imports in JS files
- Use dynamic imports for route-specific code

### **6. Eliminate Render-Blocking Resources** ⭐⭐
**Savings:** 450ms
**Status:** 🟡 Medium

**Solution:**
- Scripts already have `defer` attribute
- Consider inlining critical CSS
- Use `preload` for critical resources

## 🔧 **Accessibility Optimizations (67 → 90)**

### **1. Buttons Without Accessible Names** 🔴 Critical

**Current Issues:**
- Buttons missing `aria-label` or visible text

**Solution:**
Use the new `<x-accessible-button>` component:

```blade
<!-- Before -->
<button class="btn" onclick="closeModal()">
    <i class="fas fa-times"></i>
</button>

<!-- After -->
<x-accessible-button 
    class="btn" 
    aria-label="Close modal"
    onclick="closeModal()"
>
    <i class="fas fa-times" aria-hidden="true"></i>
</x-accessible-button>
```

### **2. Links Without Discernible Names** 🔴 Critical

**Current Issues:**
- Links with only icons or unclear text

**Solution:**
Use the new `<x-accessible-link>` component:

```blade
<!-- Before -->
<a href="/cart" class="nav-link">
    <i class="fas fa-shopping-cart"></i>
</a>

<!-- After -->
<x-accessible-link 
    href="/cart" 
    class="nav-link"
    aria-label="View shopping cart"
>
    <i class="fas fa-shopping-cart" aria-hidden="true"></i>
</x-accessible-link>
```

### **3. Insufficient Color Contrast** 🔴 Critical

**Current Issues:**
- Background and foreground colors don't meet WCAG AA standards

**Solution:**
Update CSS variables in `resources/sass/_variables.scss`:

```scss
// Ensure contrast ratios meet WCAG AA (4.5:1 for normal text, 3:1 for large text)
$primary-color: #1a1a1a; // Dark enough for good contrast
$secondary-color: #4a4a4a;
$text-color: #ffffff; // White text on dark backgrounds
$link-color: #3b82f6; // Blue with sufficient contrast
```

### **4. Frame/Iframe Missing Titles** 🟡 Medium

**Current Issues:**
- `<iframe>` elements without `title` attributes

**Solution:**
Add titles to all iframes:

```blade
<iframe 
    src="https://example.com" 
    title="Payment form"
    width="100%" 
    height="400"
></iframe>
```

## 🚀 **Implementation Priority**

### **Phase 1: Critical Performance (Week 1)**
1. ✅ Install and configure compression plugins
2. 🔴 Run image optimization script
3. 🔴 Update image components in templates
4. 🔴 Test compression and caching

### **Phase 2: Critical Accessibility (Week 1)**
1. 🔴 Update button components with accessible names
2. 🔴 Update link components with accessible names
3. 🔴 Fix color contrast issues
4. 🔴 Add titles to iframes

### **Phase 3: Advanced Optimizations (Week 2)**
1. 🔴 Implement PurgeCSS for unused CSS removal
2. 🔴 Review and optimize JavaScript bundles
3. 🔴 Implement critical CSS inlining
4. 🔴 Add preload directives

## 📋 **Testing Checklist**

### **Performance Testing:**
- [ ] Run Lighthouse audit after each optimization
- [ ] Test image loading with WebP/AVIF
- [ ] Verify compression is working (check Network tab)
- [ ] Test caching headers
- [ ] Measure bundle sizes

### **Accessibility Testing:**
- [ ] Use screen reader to test button and link accessibility
- [ ] Check color contrast with browser dev tools
- [ ] Test keyboard navigation
- [ ] Verify ARIA labels are working
- [ ] Test with high contrast mode

### **Manual Testing:**
- [ ] Test on mobile devices
- [ ] Test with slow network conditions
- [ ] Verify all functionality still works
- [ ] Check for visual regressions

## 🎯 **Expected Results**

### **After Phase 1 (Performance):**
- **Performance:** 71 → 78-82
- **Accessibility:** 67 → 67 (no change)
- **Best Practices:** 96 → 96 (maintained)
- **SEO:** 100 → 100 (maintained)

### **After Phase 2 (Accessibility):**
- **Performance:** 78-82 → 78-82 (maintained)
- **Accessibility:** 67 → 85-90
- **Best Practices:** 96 → 96 (maintained)
- **SEO:** 100 → 100 (maintained)

### **After Phase 3 (Advanced):**
- **Performance:** 78-82 → 80-85
- **Accessibility:** 85-90 → 90-95
- **Best Practices:** 96 → 96 (maintained)
- **SEO:** 100 → 100 (maintained)

## 🔄 **Commands for Implementation**

```bash
# Install dependencies
npm install vite-plugin-compression sharp @fullhuman/postcss-purgecss --save-dev

# Build with optimizations
npm run build

# Run image optimization
node scripts/optimize-images.mjs

# Test accessibility
# Use browser dev tools and screen readers

# Run Lighthouse audit
# Use Chrome DevTools Lighthouse tab
```

## 📞 **Support & Troubleshooting**

### **If Build Fails:**
1. Check for missing dependencies
2. Verify import paths
3. Clear node_modules and reinstall
4. Check for syntax errors

### **If Accessibility Issues Persist:**
1. Use browser accessibility dev tools
2. Test with screen readers
3. Check ARIA implementation
4. Verify color contrast ratios

### **If Performance Doesn't Improve:**
1. Check Network tab for compression
2. Verify image optimization worked
3. Check bundle sizes
4. Test with different network conditions

## 🎉 **Success Criteria**

The optimization is complete when:
1. ✅ Performance score ≥ 80
2. ✅ Accessibility score ≥ 90
3. ✅ Best Practices score ≥ 95 (already achieved)
4. ✅ SEO score ≥ 90 (already achieved)
5. ✅ All functionality preserved
6. ✅ No visual regressions
7. ✅ Accessibility compliance verified

**Current Status:** 🟡 In Progress - Ready for Phase 1 implementation 